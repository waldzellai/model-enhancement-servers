# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
FROM node:lts-alpine AS build
WORKDIR /app

# Copy entire monorepo
COPY . .

# Install dependencies (ignore prepare to avoid circular build)
RUN npm install --ignore-scripts

# Build only the analogical reasoning workspace
RUN npm run build --workspace=@waldzellai/analogical-reasoning

FROM node:lts-alpine AS runtime
WORKDIR /app

# Copy built server and node modules
COPY --from=build /app/src/analogical-reasoning/dist ./dist
COPY --from=build /app/node_modules ./node_modules
COPY src/analogical-reasoning/package.json ./

ENV NODE_ENV=production

ENTRYPOINT ["node", "dist/index.js"]
