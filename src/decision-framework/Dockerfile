# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
# syntax=docker/dockerfile:1

# Build stage
FROM node:lts-alpine AS build
WORKDIR /repo

# Copy monorepo root files
COPY package.json tsconfig.json ./
# Copy workspace package files
COPY src/decision-framework/package.json src/decision-framework/tsconfig.json ./src/decision-framework/
# Copy all source code
COPY src ./src

# Install dependencies and build the Decision Framework workspace
RUN npm install --ignore-scripts
RUN npm run build --workspace=@waldzellai/decision-framework

# Runtime stage
FROM node:lts-alpine AS runtime
WORKDIR /app

# Copy production dependencies (including workspace deps)
COPY --from=build /repo/node_modules ./node_modules
# Copy built artifacts and package definition
COPY --from=build /repo/src/decision-framework/dist ./dist
COPY --from=build /repo/src/decision-framework/package.json ./

ENV NODE_ENV=production

# Launch the MCP server
ENTRYPOINT ["node", "dist/index.js"]
CMD []
