# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
# syntax=docker/dockerfile:1
# Build the MCP server
FROM node:lts-alpine AS build
WORKDIR /app

# Copy root TypeScript config
COPY tsconfig.json ./tsconfig.json

# Copy project files
COPY src/collaborative-reasoning /app/src/collaborative-reasoning

# Build inside project directory
WORKDIR /app/src/collaborative-reasoning

# Install dependencies (including dev for build tools)
RUN npm install
# Build TypeScript
RUN npm run build

# Runtime image
FROM node:lts-alpine AS runtime
WORKDIR /app

# Copy built artifacts
COPY --from=build /app/src/collaborative-reasoning/dist ./dist
# Copy project manifest
COPY --from=build /app/src/collaborative-reasoning/package.json ./package.json
# Copy node_modules (including prod and dev)
COPY --from=build /app/src/collaborative-reasoning/node_modules ./node_modules

ENV NODE_ENV=production

ENTRYPOINT ["node", "dist/index.js"]
